<view class="container">
  <!-- Header (Nav Bar) -->
  <view class="header">
    <view class="header-left" bindtap="onTapBack">
      <view class="back-icon">
        <image class="back-arrow" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCAxMiAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTEgMUwyIDEwTDExIDE5IiBzdHJva2U9IiMzMzMzMzMiIHN0cm9rZS13aWR0aD0iMi41IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=" />
      </view>
    </view>
    <view class="header-right">
      <view class="menu-icon">
        <image class="menu-lines" src="data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M4 6H20M4 12H20M4 18H20' stroke='%23333333' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E" />
      </view>
    </view>
    <view class="header-title">天气</view>
  </view>

  <!-- Location and Map Row -->
  <view class="location-row">
    <view class="location-info">
      <view class="location-main">{{locationName}}</view>
      <view class="location-sub">{{locationAddress}}</view>
      <view class="location-date">{{dateString}}</view>
    </view>
    <view class="map-box" bindtap="onTapMap">
      <!-- Live Map Component -->
      <map 
        class="map-bg" 
        latitude="{{latitude}}" 
        longitude="{{longitude}}" 
        scale="14" 
        enable-scroll="{{false}}" 
        enable-zoom="{{false}}" 
        enable-rotate="{{false}}"
        enable-satellite="{{false}}"
        enable-traffic="{{false}}"
      ></map>
      <!-- Center Red Dot Marker -->
      <cover-view class="map-center-marker"></cover-view>
      <!-- Transparent cover to capture tap if map consumes it differently -->
      <cover-view class="map-cover" bindtap="onTapMap"></cover-view>
    </view>
  </view>

  <!-- Main Weather Card -->
  <view class="weather-card" bindtap="onTapTemp">
    <view class="weather-content">
      <!-- Left: Sun Icon -->
      <view class="weather-icon-section">
        <image class="sun-icon" src="/assets/sun-icon.png" mode="widthFix" />
        <view class="weather-status">
            <text class="status-main">sunny</text>
            <text class="status-sub">early warning</text>
        </view>
      </view>

      <!-- Right: Info -->
      <view class="weather-info-section">
        <text class="weather-temp">3°</text>
        <text class="weather-feels-like">体感温度：-1°</text>
        <view class="weather-range">
          <text class="range-text">-11°</text>
          <text class="range-text">6°</text>
        </view>
      </view>
    </view>
  </view>

  <!-- Grid Stats -->
  <view class="stats-grid">
    <view class="stat-item" bindtap="onTapWind">
      <view class="stat-icon-box">
        <image class="stat-icon" src="/assets/icons/wind.svg" />
      </view>
      <text class="stat-label">风</text>
    </view>
    <view class="stat-item" bindtap="onTapHumidity">
      <view class="stat-icon-box">
        <image class="stat-icon" src="/assets/icons/humidity.svg" />
      </view>
      <text class="stat-label">湿度</text>
    </view>
    <view class="stat-item" bindtap="onTapUV">
      <view class="stat-icon-box">
        <image class="stat-icon" src="/assets/icons/uv.svg" />
      </view>
      <text class="stat-label">紫外线</text>
    </view>
  </view>

  <!-- Hourly Forecast -->
  <view class="forecast-section">
    <view class="forecast-title">
      <text class="title-zh">今日</text>
      <text class="title-en">Today</text>
    </view>
    <scroll-view class="forecast-scroll" scroll-x="true" style="width: 100%; white-space: nowrap;">
      <view class="forecast-item {{item.active ? 'active' : ''}}" wx:for="{{hourlyForecast}}" wx:key="time">
        <text class="forecast-time">{{item.time}}</text>
        <view class="forecast-icon-box">
             <image class="forecast-icon" wx:if="{{item.icon === 'wind'}}" src="/assets/icons/wind-sm-v2.svg" />
             <image class="forecast-icon" wx:elif="{{item.icon === 'cloud'}}" src="/assets/icons/cloud-sm-v2.svg" />
             <image class="forecast-icon" wx:elif="{{item.icon === 'sunny'}}" src="/assets/icons/sun-sm-v2.svg" />
             <image class="forecast-icon" wx:elif="{{item.icon === 'moon'}}" src="/assets/icons/moon-sm-v2.svg" />
             <image class="forecast-icon" wx:elif="{{item.icon === 'sunrise'}}" src="/assets/icons/sunrise-sm-v2.svg" />
             <image class="forecast-icon" wx:elif="{{item.icon === 'sunset'}}" src="/assets/icons/sunset-sm-v2.svg" />
             <image class="forecast-icon" wx:else src="/assets/icons/cloud-sm-v2.svg" />
        </view>
        <text class="forecast-temp">{{item.temp}}</text>
      </view>
    </scroll-view>
  </view>
  
  <view class="bottom-spacer"></view>
  <custom-tabbar />
</view>