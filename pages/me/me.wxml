<view class="page">
  <!-- Custom Header -->
  <view class="custom-header">
    <view class="icon-btn settings-btn" bindtap="onTapSettings">
      <view class="gear-icon">âš™ï¸</view>
    </view>
    <view class="icon-btn share-btn">
      <view class="share-icon">â¤</view>
    </view>
  </view>

  <!-- User Profile -->
  <view class="profile-section">
    <view class="avatar-wrap" bindtap="onTapAvatar">
      <image class="avatar" src="/assets/avatar-me.png" mode="aspectFill" />
    </view>
    <text class="username">{{userInfo.name}}</text>
    <text class="userid">id:{{userInfo.id}}</text>
  </view>

  <!-- Tabs -->
  <view class="tabs-row">
    <view 
      class="tab-item {{activeTab === item.key ? 'active' : ''}}" 
      wx:for="{{tabs}}" 
      wx:key="key"
      bindtap="onTabClick"
      data-key="{{item.key}}"
    >
      {{item.label}}
    </view>
  </view>

  <!-- Content Area -->
  <scroll-view scroll-y class="content-area" wx:if="{{activeTab === 'personal'}}">
    <!-- Health Guide Card -->
    <view class="health-card" bindtap="onTapHealthType">
      <view class="health-card-left">
        <view class="health-type">é˜³è™šè´¨</view>
        <view class="health-subtitle">ç”Ÿæ´»æŒ‡å—</view>
      </view>
      <view class="health-card-right">
        <view class="guide-item" wx:for="{{healthGuide.items}}" wx:key="label">
          <text class="guide-label">{{item.label}}ï¼š</text>
          <text class="guide-content">{{item.content}}</text>
        </view>
      </view>
    </view>

    <!-- Bottom Grid -->
    <view class="bottom-grid">
      <!-- Left Large Image -->
      <view class="grid-left" bindtap="onChooseGridImage">
        <image class="soup-image" src="{{customGridImage}}" mode="aspectFill" />
      </view>
      
      <!-- Right Column -->
      <view class="grid-right">
        <!-- Top Small Card (Illustration) -->
        <view class="grid-card illustration-card" bindtap="onTapHealthType">
          <view class="illustration-content">
            <text class="illustration-text">å¯’é£å‘¼å•¸ï¼Œæ³¨æ„ä¿æš–</text>
            <view class="thought-dot-1"></view>
            <view class="thought-dot-2"></view>
          </view>
          <image class="illustration-graphic" src="data:image/svg+xml;charset=utf-8,%3Csvg width='140' height='140' viewBox='0 0 140 140' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='70' cy='50' r='30' fill='%23FFCCBC'/%3E%3Cpath d='M70 80 Q30 140 110 140 H30 Z' fill='%23FFAB91'/%3E%3C/svg%3E" mode="aspectFit" />
          <view class="illustration-tag">
            <text class="leaf-icon">ğŸƒ</text>
            <text>é˜³è™šè´¨</text>
          </view>
        </view>
        
        <!-- Bottom Small Card (Days) -->
        <view class="grid-card days-card">
          <view class="days-label">ç›¸ä¼´</view>
          <view class="days-count">{{daysCount}}</view>
          <view class="days-unit">DAYS</view>
          <view class="days-date">{{startDate}}</view>
        </view>
      </view>
    </view>
    
    <!-- Padding for tabbar -->
    <view style="height: 160rpx;"></view>
  </scroll-view>

  <!-- Collect Tab Content -->
  <scroll-view scroll-y class="content-area" wx:if="{{activeTab === 'collect'}}">
    
    <!-- My Recipes Section -->
    <view class="section-header">
      <text class="section-title">æˆ‘çš„é£Ÿè°±</text>
    </view>
    <scroll-view scroll-x class="horizontal-scroll" enable-flex>
      <view class="recipe-card" wx:for="{{collectedRecipes}}" wx:key="id" bindtap="onTapRecipe" data-id="{{item.id}}">
        <image class="recipe-img" src="{{item.imageUrl}}" mode="aspectFill" />
        <view class="recipe-info">
          <view class="recipe-title-row">
            <text class="recipe-title">{{item.name}}</text>
            <view class="heart-icon">â™¡</view>
          </view>
          <view class="recipe-tags">
            <view class="tag-row" wx:for="{{item.tags}}" wx:key="*this">
               <text class="tag-dot">Â·</text><text>{{item}}</text>
            </view>
          </view>
          <view class="recipe-suitable">é€‚å®œäººç¾¤ï¼š{{item.suitable}}</view>
        </view>
      </view>
    </scroll-view>

    <!-- My Herbs Section -->
    <view class="section-header">
      <text class="section-title">æˆ‘çš„è¯æ</text>
    </view>
    <scroll-view scroll-x class="horizontal-scroll" enable-flex>
      <view class="herb-card" wx:for="{{collectedHerbs}}" wx:key="id">
        <!-- Plant Image -->
        <image class="herb-img" src="{{item.imageUrl || '/assets/herb-placeholder.png'}}" mode="aspectFit" />
        
        <!-- Date Badge -->
        <view class="herb-date-box">
           <view class="date-row">
             <text class="date-day">{{item.day}}</text>
             <text class="date-month">/{{item.month}}</text>
           </view>
           <text class="lunar-date">{{item.lunarDate}}</text>
           <view class="yi-ji-row">
             <view class="dot yi"></view>
             <text class="yi-ji-text">å®œ {{item.yi}}</text>
           </view>
           <view class="yi-ji-row">
             <view class="dot ji"></view>
             <text class="yi-ji-text">å¿Œ {{item.ji}}</text>
           </view>
        </view>

        <!-- Content -->
        <view class="herb-info">
           <view class="herb-name-row">
             <text class="herb-name">{{item.name}}</text>
             <text class="herb-alias">{{item.alias}}</text>
           </view>
           
           <view class="herb-details">
             <view class="herb-detail-item" wx:for="{{item.details}}" wx:key="label" wx:for-item="detail">
               <text class="detail-label">ã€{{detail.label}}ã€‘</text>
               <text class="detail-content">ï¼š{{detail.content}}</text>
             </view>
           </view>
        </view>

         <view class="heart-icon-herb">â™¡</view>
      </view>
    </scroll-view>

    <!-- Padding for tabbar -->
    <view style="height: 160rpx;"></view>
  </scroll-view>

  <!-- Record Tab Content -->
  <scroll-view scroll-y class="content-area" wx:if="{{activeTab === 'record'}}">
    <view class="record-grid">
      <view class="record-item" wx:for="{{recordList}}" wx:key="id" bindtap="onTapRecipe" data-id="{{item.id}}">
        <image class="record-img" src="{{item.imageUrl}}" mode="aspectFill" />
        <text class="record-date">{{item.date}}</text>
      </view>
    </view>
    <view style="height: 160rpx;"></view>
  </scroll-view>

  <custom-tabbar active="me" />
</view>