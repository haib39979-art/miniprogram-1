<view class="page">
  <scroll-view class="content" scroll-y>
    <view class="topbar">
      <view class="topbar-weather" bindtap="onTapWeather">
        <text class="topbar-title">今日天气</text>
        <!-- Weather Icon: Cloud + Snow -->
        <image class="weather-icon-svg" src="/assets/weather-cloud-snow.svg" mode="aspectFit" />
      </view>
    </view>

    <view class="hero-card" bindtap="onTapHero">
      <view class="hero-actions-right">
        <button class="icon-btn" catchtap="onToggleFavorite">
          <text class="icon-text">{{isFavorite ? '♥' : '♡'}}</text>
        </button>
      </view>

      <view class="hero-main">
        <view class="hero-left">
          <view class="herb-image-wrap">
            <view class="herb-image-inner">
              <image class="herb-image" src="{{herb.imageUrl}}" mode="aspectFit" />
              <view class="herb-name-overlay">
                <text class="herb-name-main">{{herb.name}}</text>
                <text class="herb-name-sub">{{herb.alias}}</text>
              </view>
              <view class="magnifier-icon">
                <view class="magnifier-circle"><text class="magnifier-plus">+</text></view>
                <view class="magnifier-handle"></view>
              </view>
            </view>
          </view>
        </view>

        <view class="hero-right">
          <view class="date-section">
            <view class="date-row">
              <text class="date-day">{{date.day}}</text>
              <text class="date-suffix">/{{date.month}}</text>
            </view>
            <text class="lunar-text">{{date.lunar}}</text>
          </view>

          <view class="info-box">
            <view class="yi-ji-section">
              <view class="yi-block">
                <view class="yi-header">
                  <view class="dot dot-yi"></view>
                  <text class="yi-label">宜</text>
                </view>
                <text class="yi-content">{{daily.yi}}</text>
              </view>
              
              <view class="ji-block">
                <view class="ji-header">
                  <view class="dot dot-ji"></view>
                  <text class="ji-label">忌</text>
                </view>
                <text class="ji-content">{{daily.ji}}</text>
              </view>
            </view>

            <view class="huangli-wrap">
              <image wx:if="{{huangli.imageUrl}}" class="huangli-image" src="{{huangli.imageUrl}}" mode="aspectFill" />
              <view wx:else class="huangli-placeholder">
                <view class="huangli-header">
                  <view class="huangli-dot"></view>
                  <text class="huangli-title">黄历</text>
                </view>
                <view class="huangli-lines">
                  <view class="huangli-line"></view>
                  <view class="huangli-line"></view>
                  <view class="huangli-line"></view>
                  <view class="huangli-line short"></view>
                </view>
                <view class="huangli-stamp">宜养</view>
              </view>
            </view>
          </view>
        </view>
      </view>

      <view class="hero-name-row">
        <text class="hero-name-title">{{herb.name}}</text>
        <text class="hero-name-alias">.{{herb.alias}}</text>
      </view>

      <view class="hero-details">
        <view class="detail-row">
          <view class="bullet"></view>
          <text class="detail-text">{{herb.distribution}}</text>
        </view>
        <view class="detail-row">
          <view class="bullet"></view>
          <text class="detail-text">{{herb.feature}}</text>
        </view>
        <view class="detail-row">
          <view class="bullet"></view>
          <text class="detail-text">{{herb.effect}}</text>
        </view>
        <view class="detail-row">
          <view class="bullet"></view>
          <text class="detail-text">{{herb.usage}}</text>
        </view>
      </view>
    </view>

    <view class="todos-header">
      <text class="todos-title">每日事项</text>
      <button class="add-btn" bindtap="onAddTodo">+</button>
    </view>

    <view class="todos-empty" wx:if="{{!todos || todos.length === 0}}">
      <text class="todos-empty-text">今天还没有事项</text>
    </view>
    <view class="todos-list" wx:else>
      <view class="todo-item" wx:for="{{todos}}" wx:key="id">
        <text class="todo-text">{{item.text}}</text>
      </view>
    </view>

    <view class="bottom-spacer"></view>
  </scroll-view>
  <custom-tabbar active="calendar" />
</view>
